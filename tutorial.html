<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>FSharpComposableQuery Tutorial
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A short summary of your project">
    <meta name="author" content="Your Name">

    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/content/style.css" />
    <script type="text/javascript" src="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/fsharp/FSharpComposableQuery">github page</a></li>
        </ul>
        <h3 class="muted">FSharpComposableQuery</h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>FSharpComposableQuery Tutorial</h1>

<p>(<strong>work in progress</strong>)</p>

<h2>Basic Queries</h2>

<p>For instruction on how to obtain and install the <strong>FSharpComposableQuery</strong> library, 
check out the <a href="./index.html">main page</a>.</p>

<p>All existing F# database and in-memory queries should work as normal. For example:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">data</span> <span class="o">=</span> [<span class="n">1</span>; <span class="n">5</span>; <span class="n">7</span>; <span class="n">11</span>; <span class="n">18</span>; <span class="n">21</span>]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">lastNumberInSortedList</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">query</span> {
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">s</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="i">data</span> <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="k">sortBy</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">s</span>
        <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="k">last</span>
    }

    </pre>
</td>
</tr>
</table>

<h2>Advanced Queries</h2>

<p>In addition, more queries and techniques work as compared to the default <code>Microsoft.FSharp.Core.QueryBuilder</code>.</p>

<p>We illustrate this through several examples.</p>

<h3>Parameterizing a query</h3>

<p>LINQ already supports queries with parameters, as long as those parameters are of base type. For example, 
to obtain the set of people with age in a given interval, you can create a query parameterized by two integers:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// Connect to the SQL data source</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">dbPeople</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">SqlDataConnection</span><span class="o">&lt;</span><span class="i">ConnectionStringName</span><span class="o">=</span><span class="s">&quot;</span><span class="s">PeopleConnectionString</span><span class="s">&quot;</span>, <span class="i">ConfigFile</span><span class="o">=</span><span class="s">&quot;</span><span class="s">db</span><span class="s">.</span><span class="s">config</span><span class="s">&quot;</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="i">db</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 12)" onmouseover="showTip(event, 'fs7', 12)" class="i">dbPeople</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="i">GetDataContext</span>()

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">Person</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 15)" onmouseover="showTip(event, 'fs7', 15)" class="i">dbPeople</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="i">ServiceTypes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="i">People</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 18)" onmouseover="showTip(event, 'fs14', 18)" class="i">range1</span> <span class="o">=</span> <span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs15', 19)" onmouseover="showTip(event, 'fs15', 19)" class="i">a</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 20)" onmouseover="showTip(event, 'fs16', 20)" class="i">int</span>) (<span onmouseout="hideTip(event, 'fs17', 21)" onmouseover="showTip(event, 'fs17', 21)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="i">int</span>) <span class="k">-&gt;</span> 
  <span onmouseout="hideTip(event, 'fs3', 23)" onmouseover="showTip(event, 'fs3', 23)" class="i">query</span> {
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 24)" onmouseover="showTip(event, 'fs18', 24)" class="i">u</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 25)" onmouseover="showTip(event, 'fs9', 25)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 26)" onmouseover="showTip(event, 'fs19', 26)" class="i">People</span> <span class="k">do</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs15', 27)" onmouseover="showTip(event, 'fs15', 27)" class="i">a</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs18', 28)" onmouseover="showTip(event, 'fs18', 28)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="i">Age</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs18', 30)" onmouseover="showTip(event, 'fs18', 30)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 31)" onmouseover="showTip(event, 'fs20', 31)" class="i">Age</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs17', 32)" onmouseover="showTip(event, 'fs17', 32)" class="i">b</span> 
    <span class="k">then</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 33)" onmouseover="showTip(event, 'fs18', 33)" class="i">u</span>
    } 

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 34)" onmouseover="showTip(event, 'fs21', 34)" class="i">ex1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 35)" onmouseover="showTip(event, 'fs14', 35)" class="i">range1</span> <span class="n">30</span> <span class="n">40</span></pre>
</td>
</tr>
</table>

<p>However, doing it this way is not especially reusable, and we recommend doing it this way instead:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 36)" onmouseover="showTip(event, 'fs22', 36)" class="i">range</span> <span class="o">=</span> &lt;@ <span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs15', 37)" onmouseover="showTip(event, 'fs15', 37)" class="i">a</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 38)" onmouseover="showTip(event, 'fs16', 38)" class="i">int</span>) (<span onmouseout="hideTip(event, 'fs17', 39)" onmouseover="showTip(event, 'fs17', 39)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 40)" onmouseover="showTip(event, 'fs16', 40)" class="i">int</span>) <span class="k">-&gt;</span> 
  <span onmouseout="hideTip(event, 'fs3', 41)" onmouseover="showTip(event, 'fs3', 41)" class="i">query</span> {
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 42)" onmouseover="showTip(event, 'fs18', 42)" class="i">u</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 43)" onmouseover="showTip(event, 'fs9', 43)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 44)" onmouseover="showTip(event, 'fs19', 44)" class="i">People</span> <span class="k">do</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs15', 45)" onmouseover="showTip(event, 'fs15', 45)" class="i">a</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs18', 46)" onmouseover="showTip(event, 'fs18', 46)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 47)" onmouseover="showTip(event, 'fs20', 47)" class="i">Age</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs18', 48)" onmouseover="showTip(event, 'fs18', 48)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 49)" onmouseover="showTip(event, 'fs20', 49)" class="i">Age</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs17', 50)" onmouseover="showTip(event, 'fs17', 50)" class="i">b</span> 
    <span class="k">then</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 51)" onmouseover="showTip(event, 'fs18', 51)" class="i">u</span>
    }  @&gt;
    
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 52)" onmouseover="showTip(event, 'fs23', 52)" class="i">ex2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 53)" onmouseover="showTip(event, 'fs3', 53)" class="i">query</span> { <span class="k">yield!</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs22', 54)" onmouseover="showTip(event, 'fs22', 54)" class="i">range</span>) <span class="n">30</span> <span class="n">40</span> }</pre>
</td>
</tr>
</table>

<p>The reason is that the first approach only works if the parameters are of base type;
the second is more flexible.</p>

<h3>A note on evaluation</h3>

<p>As you may have noticed from the previous example we used a slightly different method of evaluating the query.</p>

<p>If we simply wrote:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 55)" onmouseover="showTip(event, 'fs24', 55)" class="i">ex2wrong</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs25', 56)" onmouseover="showTip(event, 'fs25', 56)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 57)" onmouseover="showTip(event, 'fs26', 57)" class="i">Linq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 58)" onmouseover="showTip(event, 'fs27', 58)" class="i">IQueryable</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs11', 59)" onmouseover="showTip(event, 'fs11', 59)" class="i">Person</span><span class="o">&gt;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 60)" onmouseover="showTip(event, 'fs3', 60)" class="i">query</span> { (<span class="o">%</span><span onmouseout="hideTip(event, 'fs22', 61)" onmouseover="showTip(event, 'fs22', 61)" class="i">range</span>) <span class="n">30</span> <span class="n">40</span> }</pre>
</td>
</tr>
</table>

<p>The resulting query would still type-check, compile and execute fine, but the result variable will always contain 
the empty sequence. This happens as the <code>QueryBuilder</code> uses the reserved keywords <code>yield</code> (for a single item) and 
<code>yield!</code> (for collections of items) to add results to the output. As the result of <code>(%range) a b</code> is not explicitly 
returned by either, it gets discarded instead.</p>

<p>To use composite queries properly, we should simply return the results of a query using either keyword as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 62)" onmouseover="showTip(event, 'fs28', 62)" class="i">ex2again</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 63)" onmouseover="showTip(event, 'fs3', 63)" class="i">query</span> { <span class="k">yield!</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs22', 64)" onmouseover="showTip(event, 'fs22', 64)" class="i">range</span>) <span class="n">30</span> <span class="n">40</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 65)" onmouseover="showTip(event, 'fs29', 65)" class="i">ex2again&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 66)" onmouseover="showTip(event, 'fs3', 66)" class="i">query</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs30', 67)" onmouseover="showTip(event, 'fs30', 67)" class="i">x</span> <span class="k">in</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs22', 68)" onmouseover="showTip(event, 'fs22', 68)" class="i">range</span>) <span class="n">30</span> <span class="n">40</span> <span class="k">do</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs30', 69)" onmouseover="showTip(event, 'fs30', 69)" class="i">x</span> }     <span class="c">// same as ex2again</span></pre>
</td>
</tr>
</table>

<p>What about queries which return a single value?</p>

<p>Such queries include operations that return base or record types, such as the <code>count</code>, <code>last</code> and <code>averageBy</code> methods. 
Here is an example query which counts the number of people in a given age range:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 70)" onmouseover="showTip(event, 'fs31', 70)" class="i">countRange</span> <span class="o">=</span> &lt;@ <span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs15', 71)" onmouseover="showTip(event, 'fs15', 71)" class="i">a</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 72)" onmouseover="showTip(event, 'fs16', 72)" class="i">int</span>) (<span onmouseout="hideTip(event, 'fs17', 73)" onmouseover="showTip(event, 'fs17', 73)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 74)" onmouseover="showTip(event, 'fs16', 74)" class="i">int</span>) <span class="k">-&gt;</span> 
    <span onmouseout="hideTip(event, 'fs3', 75)" onmouseover="showTip(event, 'fs3', 75)" class="i">query</span> { 
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 76)" onmouseover="showTip(event, 'fs18', 76)" class="i">u</span> <span class="k">in</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs22', 77)" onmouseover="showTip(event, 'fs22', 77)" class="i">range</span>) <span onmouseout="hideTip(event, 'fs15', 78)" onmouseover="showTip(event, 'fs15', 78)" class="i">a</span> <span onmouseout="hideTip(event, 'fs17', 79)" onmouseover="showTip(event, 'fs17', 79)" class="i">b</span> <span class="k">do</span> 
        <span onmouseout="hideTip(event, 'fs32', 80)" onmouseover="showTip(event, 'fs32', 80)" class="k">count</span> 
    } @&gt;</pre>
</td>
</tr>
</table>

<p>Suppose we wanted to find the number of people in their thirties. Knowing that <code>countRange</code> returns a single value 
(in this case an <code>int</code>) we could try to passing its result to the <code>yield</code> method as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 81)" onmouseover="showTip(event, 'fs33', 81)" class="i">countWrong</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 82)" onmouseover="showTip(event, 'fs3', 82)" class="i">query</span> { <span class="k">yield</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs31', 83)" onmouseover="showTip(event, 'fs31', 83)" class="i">countRange</span>) <span class="n">30</span> <span class="n">40</span> }</pre>
</td>
</tr>
</table>

<p>This solution is far from perfect though: the variable <code>countWrong</code> is of type <code>IQueryable&lt;int&gt;</code> when we would actually 
expect it to be of type <code>int</code>. This happens as <code>yield</code> returns the item as part of a collection.</p>

<p>Now, <em>we</em> know there is <em>exactly</em> one item in this sequence, so we could access it using any of the methods in the <code>Seq</code> 
module or the standard LINQ extensions. 
Fortunately, there is an easier, built-in way to evaluate such expressions, which is to simply pass them to the 
<code>query.Run</code> method:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 84)" onmouseover="showTip(event, 'fs34', 84)" class="i">countCorrect</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 85)" onmouseover="showTip(event, 'fs3', 85)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 86)" onmouseover="showTip(event, 'fs35', 86)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs31', 87)" onmouseover="showTip(event, 'fs31', 87)" class="i">countRange</span>) <span class="n">30</span> <span class="n">40</span> @&gt;</pre>
</td>
</tr>
</table>

<p>This way the resulting variable <code>countCorrect</code> is of the expected type <code>int</code>.</p>

<h3>Building queries using query combinators</h3>

<p>We can also build queries using other query combinators. Suppose we want to find the people who are older than 
a given person and at the same time younger than another.</p>

<p>The naive way of doing this, using a single parameterized query, would be:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 88)" onmouseover="showTip(event, 'fs36', 88)" class="i">composeMonolithic</span> <span class="o">=</span> 
    &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs37', 89)" onmouseover="showTip(event, 'fs37', 89)" class="i">s</span> <span onmouseout="hideTip(event, 'fs38', 90)" onmouseover="showTip(event, 'fs38', 90)" class="i">t</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 91)" onmouseover="showTip(event, 'fs3', 91)" class="i">query</span> {
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs39', 92)" onmouseover="showTip(event, 'fs39', 92)" class="i">u1</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 93)" onmouseover="showTip(event, 'fs9', 93)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 94)" onmouseover="showTip(event, 'fs19', 94)" class="i">People</span> <span class="k">do</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs40', 95)" onmouseover="showTip(event, 'fs40', 95)" class="i">u2</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 96)" onmouseover="showTip(event, 'fs9', 96)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 97)" onmouseover="showTip(event, 'fs19', 97)" class="i">People</span> <span class="k">do</span> 
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 98)" onmouseover="showTip(event, 'fs18', 98)" class="i">u</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 99)" onmouseover="showTip(event, 'fs9', 99)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 100)" onmouseover="showTip(event, 'fs19', 100)" class="i">People</span> <span class="k">do</span>
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs37', 101)" onmouseover="showTip(event, 'fs37', 101)" class="i">s</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 102)" onmouseover="showTip(event, 'fs39', 102)" class="i">u1</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 103)" onmouseover="showTip(event, 'fs41', 103)" class="i">Name</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs38', 104)" onmouseover="showTip(event, 'fs38', 104)" class="i">t</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs40', 105)" onmouseover="showTip(event, 'fs40', 105)" class="i">u2</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 106)" onmouseover="showTip(event, 'fs41', 106)" class="i">Name</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs39', 107)" onmouseover="showTip(event, 'fs39', 107)" class="i">u1</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 108)" onmouseover="showTip(event, 'fs20', 108)" class="i">Age</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs18', 109)" onmouseover="showTip(event, 'fs18', 109)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 110)" onmouseover="showTip(event, 'fs20', 110)" class="i">Age</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs18', 111)" onmouseover="showTip(event, 'fs18', 111)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 112)" onmouseover="showTip(event, 'fs20', 112)" class="i">Age</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs40', 113)" onmouseover="showTip(event, 'fs40', 113)" class="i">u2</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 114)" onmouseover="showTip(event, 'fs20', 114)" class="i">Age</span> <span class="k">then</span>
                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 115)" onmouseover="showTip(event, 'fs18', 115)" class="i">u</span>
    } @&gt;</pre>
</td>
</tr>
</table>

<p>We can see this solution is far from ideal: there is code duplication, renaming of variables, and it may be hard
to spot the overall structure.  Moreover, while this query is easy enough to compose in one's head, keeping 
track of the different parameters and constraints becomes more tedious and error-prone as the size and number of tables 
involved in a query grows.</p>

<p>Compare the previous example to the following one:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 116)" onmouseover="showTip(event, 'fs42', 116)" class="i">ageFromName</span> <span class="o">=</span> 
  &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs37', 117)" onmouseover="showTip(event, 'fs37', 117)" class="i">s</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 118)" onmouseover="showTip(event, 'fs3', 118)" class="i">query</span> {
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 119)" onmouseover="showTip(event, 'fs18', 119)" class="i">u</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 120)" onmouseover="showTip(event, 'fs9', 120)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 121)" onmouseover="showTip(event, 'fs19', 121)" class="i">People</span> <span class="k">do</span> 
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs37', 122)" onmouseover="showTip(event, 'fs37', 122)" class="i">s</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 123)" onmouseover="showTip(event, 'fs18', 123)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 124)" onmouseover="showTip(event, 'fs41', 124)" class="i">Name</span> <span class="k">then</span> 
                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 125)" onmouseover="showTip(event, 'fs18', 125)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 126)" onmouseover="showTip(event, 'fs20', 126)" class="i">Age</span> } @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 127)" onmouseover="showTip(event, 'fs43', 127)" class="i">compose</span> <span class="o">=</span> 
  &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs37', 128)" onmouseover="showTip(event, 'fs37', 128)" class="i">s</span> <span onmouseout="hideTip(event, 'fs38', 129)" onmouseover="showTip(event, 'fs38', 129)" class="i">t</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 130)" onmouseover="showTip(event, 'fs3', 130)" class="i">query</span> {
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs15', 131)" onmouseover="showTip(event, 'fs15', 131)" class="i">a</span> <span class="k">in</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs42', 132)" onmouseover="showTip(event, 'fs42', 132)" class="i">ageFromName</span>) <span onmouseout="hideTip(event, 'fs37', 133)" onmouseover="showTip(event, 'fs37', 133)" class="i">s</span> <span class="k">do</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs17', 134)" onmouseover="showTip(event, 'fs17', 134)" class="i">b</span> <span class="k">in</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs42', 135)" onmouseover="showTip(event, 'fs42', 135)" class="i">ageFromName</span>) <span onmouseout="hideTip(event, 'fs38', 136)" onmouseover="showTip(event, 'fs38', 136)" class="i">t</span> <span class="k">do</span> 
            <span class="k">yield!</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs22', 137)" onmouseover="showTip(event, 'fs22', 137)" class="i">range</span>) <span onmouseout="hideTip(event, 'fs15', 138)" onmouseover="showTip(event, 'fs15', 138)" class="i">a</span> <span onmouseout="hideTip(event, 'fs17', 139)" onmouseover="showTip(event, 'fs17', 139)" class="i">b</span>
  } @&gt;</pre>
</td>
</tr>
</table>

<p>This way of defining a query exemplifies the logical meaning of the query, and makes it much easier to understand its 
purpose from the code.</p>

<p>Although one can construct similar queries using the default F# builder, the problem is that the generated SQL query will
be quite inefficient. The role of the <strong>FSharpComposableQuery</strong> library in the evaluation of this query is to normalize it to
a form at least as efficient as the flat query above. In fact, all queries which have an equivalent flat form get reduced 
to it as part of the normalisation procedure.</p>

<h2>Higher-order parameters</h2>

<p><strong>FSharpComposableQuery</strong> lifts the intuitive restriction that the parameters to a query have to be of base type: instead,
they can be higher-order functions. It is not that F# fails to handle higher-order functions, but FSharpComposableQuery 
provides a stronger guarantee of good behavior.</p>

<p>For example, we can define the following query combinator that gets all people whose age matches the argument predicate:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 140)" onmouseover="showTip(event, 'fs44', 140)" class="i">satisfies</span>  <span class="o">=</span> 
 &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs45', 141)" onmouseover="showTip(event, 'fs45', 141)" class="i">p</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 142)" onmouseover="showTip(event, 'fs3', 142)" class="i">query</span> { 
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 143)" onmouseover="showTip(event, 'fs18', 143)" class="i">u</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs9', 144)" onmouseover="showTip(event, 'fs9', 144)" class="i">db</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 145)" onmouseover="showTip(event, 'fs19', 145)" class="i">People</span> <span class="k">do</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs45', 146)" onmouseover="showTip(event, 'fs45', 146)" class="i">p</span> <span onmouseout="hideTip(event, 'fs18', 147)" onmouseover="showTip(event, 'fs18', 147)" class="i">u</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 148)" onmouseover="showTip(event, 'fs20', 148)" class="i">Age</span> 
    <span class="k">then</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 149)" onmouseover="showTip(event, 'fs18', 149)" class="i">u</span>
   } @&gt;</pre>
</td>
</tr>
</table>

<p>We can then use it to find all people in their thirties, or all people with even age:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 150)" onmouseover="showTip(event, 'fs46', 150)" class="i">ex3</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 151)" onmouseover="showTip(event, 'fs3', 151)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 152)" onmouseover="showTip(event, 'fs35', 152)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 153)" onmouseover="showTip(event, 'fs44', 153)" class="i">satisfies</span>) (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 154)" onmouseover="showTip(event, 'fs47', 154)" class="i">x</span> <span class="k">-&gt;</span> <span class="n">20</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs47', 155)" onmouseover="showTip(event, 'fs47', 155)" class="i">x</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs47', 156)" onmouseover="showTip(event, 'fs47', 156)" class="i">x</span> <span class="o">&lt;</span> <span class="n">30</span> ) @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs48', 157)" onmouseover="showTip(event, 'fs48', 157)" class="i">ex4</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 158)" onmouseover="showTip(event, 'fs3', 158)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 159)" onmouseover="showTip(event, 'fs35', 159)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 160)" onmouseover="showTip(event, 'fs44', 160)" class="i">satisfies</span>) (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 161)" onmouseover="showTip(event, 'fs47', 161)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs47', 162)" onmouseover="showTip(event, 'fs47', 162)" class="i">x</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span> <span class="n">0</span> ) @&gt;</pre>
</td>
</tr>
</table>

<p>This is subject to some side-conditions: basically, the function you pass into a higher-order query combinator
may only perform operations that are sensible on the database; recursion and side-effects such as printing are not allowed,
and will result in a run-time error.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 163)" onmouseover="showTip(event, 'fs49', 163)" class="i">wrong1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 164)" onmouseover="showTip(event, 'fs3', 164)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 165)" onmouseover="showTip(event, 'fs35', 165)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 166)" onmouseover="showTip(event, 'fs44', 166)" class="i">satisfies</span>) (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs50', 167)" onmouseover="showTip(event, 'fs50', 167)" class="i">age</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs51', 168)" onmouseover="showTip(event, 'fs51', 168)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs50', 169)" onmouseover="showTip(event, 'fs50', 169)" class="i">age</span>; <span class="k">true</span>) @&gt;

<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs52', 170)" onmouseover="showTip(event, 'fs52', 170)" class="i">even</span> <span onmouseout="hideTip(event, 'fs53', 171)" onmouseover="showTip(event, 'fs53', 171)" class="i">n</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs53', 172)" onmouseover="showTip(event, 'fs53', 172)" class="i">n</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="k">true</span>         <span class="c">// only works for positive n</span>
                 <span class="k">else</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs53', 173)" onmouseover="showTip(event, 'fs53', 173)" class="i">n</span> <span class="o">=</span> <span class="n">1</span> <span class="k">then</span> <span class="k">false</span>
                 <span class="k">else</span> <span onmouseout="hideTip(event, 'fs52', 174)" onmouseover="showTip(event, 'fs52', 174)" class="i">even</span>(<span onmouseout="hideTip(event, 'fs53', 175)" onmouseover="showTip(event, 'fs53', 175)" class="i">n</span><span class="o">-</span><span class="n">2</span>)

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs54', 176)" onmouseover="showTip(event, 'fs54', 176)" class="i">wrong2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 177)" onmouseover="showTip(event, 'fs3', 177)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 178)" onmouseover="showTip(event, 'fs35', 178)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 179)" onmouseover="showTip(event, 'fs44', 179)" class="i">satisfies</span>) <span onmouseout="hideTip(event, 'fs52', 180)" onmouseover="showTip(event, 'fs52', 180)" class="i">even</span> @&gt;</pre>
</td>
</tr>
</table>

<p>Note that <code>wrong2</code> is morally equivalent to <code>ex4</code> above, provided ages are nonnegative, but is not allowed. The library
is not smart enough to determine that the parameter passed into <code>satisfies</code> is equivalent to an operation that
can be performed on the database (using modular arithmetic); you would have to do this yourself.</p>

<h2>Building queries dynamically (using recursion)</h2>

<p>Although recursion is not allowed <em>within</em> a query, you can still use recursion to <em>build</em> a query.</p>

<p>Consider the following data type defining some Boolean predicates on ages:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs55', 181)" onmouseover="showTip(event, 'fs55', 181)" class="i">Predicate</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs56', 182)" onmouseover="showTip(event, 'fs56', 182)" class="i">Above</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs16', 183)" onmouseover="showTip(event, 'fs16', 183)" class="i">int</span>
  | <span onmouseout="hideTip(event, 'fs57', 184)" onmouseover="showTip(event, 'fs57', 184)" class="i">Below</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs16', 185)" onmouseover="showTip(event, 'fs16', 185)" class="i">int</span>
  | <span onmouseout="hideTip(event, 'fs58', 186)" onmouseover="showTip(event, 'fs58', 186)" class="i">And</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs55', 187)" onmouseover="showTip(event, 'fs55', 187)" class="i">Predicate</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs55', 188)" onmouseover="showTip(event, 'fs55', 188)" class="i">Predicate</span>
  | <span onmouseout="hideTip(event, 'fs59', 189)" onmouseover="showTip(event, 'fs59', 189)" class="i">Or</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs55', 190)" onmouseover="showTip(event, 'fs55', 190)" class="i">Predicate</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs55', 191)" onmouseover="showTip(event, 'fs55', 191)" class="i">Predicate</span>
  | <span onmouseout="hideTip(event, 'fs60', 192)" onmouseover="showTip(event, 'fs60', 192)" class="i">Not</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs55', 193)" onmouseover="showTip(event, 'fs55', 193)" class="i">Predicate</span></pre>
</td>
</tr>
</table>

<p>For example, we can define the "in their 30s" predicate two different ways as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs61', 194)" onmouseover="showTip(event, 'fs61', 194)" class="i">t0</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs55', 195)" onmouseover="showTip(event, 'fs55', 195)" class="i">Predicate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 196)" onmouseover="showTip(event, 'fs58', 196)" class="i">And</span> (<span onmouseout="hideTip(event, 'fs56', 197)" onmouseover="showTip(event, 'fs56', 197)" class="i">Above</span> <span class="n">30</span>, <span onmouseout="hideTip(event, 'fs57', 198)" onmouseover="showTip(event, 'fs57', 198)" class="i">Below</span> <span class="n">40</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 199)" onmouseover="showTip(event, 'fs62', 199)" class="i">t1</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs55', 200)" onmouseover="showTip(event, 'fs55', 200)" class="i">Predicate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs60', 201)" onmouseover="showTip(event, 'fs60', 201)" class="i">Not</span>(<span onmouseout="hideTip(event, 'fs59', 202)" onmouseover="showTip(event, 'fs59', 202)" class="i">Or</span>(<span onmouseout="hideTip(event, 'fs57', 203)" onmouseover="showTip(event, 'fs57', 203)" class="i">Below</span> <span class="n">30</span>, <span onmouseout="hideTip(event, 'fs56', 204)" onmouseover="showTip(event, 'fs56', 204)" class="i">Above</span> <span class="n">40</span>))</pre>
</td>
</tr>
</table>

<p>We can define an evaluator that takes a predicate and produces a <em>parameterized query</em> as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs63', 205)" onmouseover="showTip(event, 'fs63', 205)" class="i">eval</span>(<span onmouseout="hideTip(event, 'fs64', 206)" onmouseover="showTip(event, 'fs64', 206)" class="i">t</span>) <span class="o">=</span>
  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs64', 207)" onmouseover="showTip(event, 'fs64', 207)" class="i">t</span> <span class="k">with</span>
  | <span onmouseout="hideTip(event, 'fs56', 208)" onmouseover="showTip(event, 'fs56', 208)" class="i">Above</span> <span onmouseout="hideTip(event, 'fs53', 209)" onmouseover="showTip(event, 'fs53', 209)" class="i">n</span> <span class="k">-&gt;</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 210)" onmouseover="showTip(event, 'fs47', 210)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs47', 211)" onmouseover="showTip(event, 'fs47', 211)" class="i">x</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 212)" onmouseover="showTip(event, 'fs53', 212)" class="i">n</span> @&gt;
  | <span onmouseout="hideTip(event, 'fs57', 213)" onmouseover="showTip(event, 'fs57', 213)" class="i">Below</span> <span onmouseout="hideTip(event, 'fs53', 214)" onmouseover="showTip(event, 'fs53', 214)" class="i">n</span> <span class="k">-&gt;</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 215)" onmouseover="showTip(event, 'fs47', 215)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs47', 216)" onmouseover="showTip(event, 'fs47', 216)" class="i">x</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs53', 217)" onmouseover="showTip(event, 'fs53', 217)" class="i">n</span> @&gt;
  | <span onmouseout="hideTip(event, 'fs58', 218)" onmouseover="showTip(event, 'fs58', 218)" class="i">And</span> (<span onmouseout="hideTip(event, 'fs65', 219)" onmouseover="showTip(event, 'fs65', 219)" class="i">t1</span>,<span onmouseout="hideTip(event, 'fs66', 220)" onmouseover="showTip(event, 'fs66', 220)" class="i">t2</span>) <span class="k">-&gt;</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 221)" onmouseover="showTip(event, 'fs47', 221)" class="i">x</span> <span class="k">-&gt;</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 222)" onmouseover="showTip(event, 'fs63', 222)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs65', 223)" onmouseover="showTip(event, 'fs65', 223)" class="i">t1</span>) <span onmouseout="hideTip(event, 'fs47', 224)" onmouseover="showTip(event, 'fs47', 224)" class="i">x</span> <span class="o">&amp;&amp;</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 225)" onmouseover="showTip(event, 'fs63', 225)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs66', 226)" onmouseover="showTip(event, 'fs66', 226)" class="i">t2</span>) <span onmouseout="hideTip(event, 'fs47', 227)" onmouseover="showTip(event, 'fs47', 227)" class="i">x</span> @&gt;
  | <span onmouseout="hideTip(event, 'fs59', 228)" onmouseover="showTip(event, 'fs59', 228)" class="i">Or</span> (<span onmouseout="hideTip(event, 'fs65', 229)" onmouseover="showTip(event, 'fs65', 229)" class="i">t1</span>,<span onmouseout="hideTip(event, 'fs66', 230)" onmouseover="showTip(event, 'fs66', 230)" class="i">t2</span>) <span class="k">-&gt;</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 231)" onmouseover="showTip(event, 'fs47', 231)" class="i">x</span> <span class="k">-&gt;</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 232)" onmouseover="showTip(event, 'fs63', 232)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs65', 233)" onmouseover="showTip(event, 'fs65', 233)" class="i">t1</span>) <span onmouseout="hideTip(event, 'fs47', 234)" onmouseover="showTip(event, 'fs47', 234)" class="i">x</span> <span class="o">||</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 235)" onmouseover="showTip(event, 'fs63', 235)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs66', 236)" onmouseover="showTip(event, 'fs66', 236)" class="i">t2</span>) <span onmouseout="hideTip(event, 'fs47', 237)" onmouseover="showTip(event, 'fs47', 237)" class="i">x</span> @&gt;
  | <span onmouseout="hideTip(event, 'fs60', 238)" onmouseover="showTip(event, 'fs60', 238)" class="i">Not</span> (<span onmouseout="hideTip(event, 'fs67', 239)" onmouseover="showTip(event, 'fs67', 239)" class="i">t0</span>) <span class="k">-&gt;</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs47', 240)" onmouseover="showTip(event, 'fs47', 240)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs68', 241)" onmouseover="showTip(event, 'fs68', 241)" class="i">not</span>((<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 242)" onmouseover="showTip(event, 'fs63', 242)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs67', 243)" onmouseover="showTip(event, 'fs67', 243)" class="i">t0</span>) <span onmouseout="hideTip(event, 'fs47', 244)" onmouseover="showTip(event, 'fs47', 244)" class="i">x</span>) @&gt;</pre>
</td>
</tr>
</table>

<p>Notice that given a predicate t, the return value of this function is a quoted function that takes an integer
and returns a boolean.  Moreover, all of the operations we used are Boolean or arithmetic comparisons that any
database can handle in queries.</p>

<p>So, we can plug the predicate obtained from evaluation into the <code>satisfies</code> query combinator, as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 245)" onmouseover="showTip(event, 'fs69', 245)" class="i">ex6</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 246)" onmouseover="showTip(event, 'fs3', 246)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 247)" onmouseover="showTip(event, 'fs35', 247)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 248)" onmouseover="showTip(event, 'fs44', 248)" class="i">satisfies</span>) (<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 249)" onmouseover="showTip(event, 'fs63', 249)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs61', 250)" onmouseover="showTip(event, 'fs61', 250)" class="i">t0</span>) @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 251)" onmouseover="showTip(event, 'fs70', 251)" class="i">ex7</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 252)" onmouseover="showTip(event, 'fs3', 252)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 253)" onmouseover="showTip(event, 'fs35', 253)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 254)" onmouseover="showTip(event, 'fs44', 254)" class="i">satisfies</span>) (<span class="o">%</span><span onmouseout="hideTip(event, 'fs63', 255)" onmouseover="showTip(event, 'fs63', 255)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs62', 256)" onmouseover="showTip(event, 'fs62', 256)" class="i">t1</span>) @&gt;</pre>
</td>
</tr>
</table>

<p>Why is this allowed, even though the <code>eval</code> function is recursive?</p>

<p>Again, notice that although <code>(%eval t)</code> evaluates recursively to a quotation, all of this happens before it is passed 
as an argument to the satisfies query.</p>

<p>Had we instead tried it in this, simpler way:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs71', 257)" onmouseover="showTip(event, 'fs71', 257)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs64', 258)" onmouseover="showTip(event, 'fs64', 258)" class="i">t</span> <span onmouseout="hideTip(event, 'fs47', 259)" onmouseover="showTip(event, 'fs47', 259)" class="i">x</span> <span class="o">=</span>
  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs64', 260)" onmouseover="showTip(event, 'fs64', 260)" class="i">t</span> <span class="k">with</span>
  | <span onmouseout="hideTip(event, 'fs56', 261)" onmouseover="showTip(event, 'fs56', 261)" class="i">Above</span> <span onmouseout="hideTip(event, 'fs53', 262)" onmouseover="showTip(event, 'fs53', 262)" class="i">n</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs47', 263)" onmouseover="showTip(event, 'fs47', 263)" class="i">x</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 264)" onmouseover="showTip(event, 'fs53', 264)" class="i">n</span>
  | <span onmouseout="hideTip(event, 'fs57', 265)" onmouseover="showTip(event, 'fs57', 265)" class="i">Below</span> <span onmouseout="hideTip(event, 'fs53', 266)" onmouseover="showTip(event, 'fs53', 266)" class="i">n</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs47', 267)" onmouseover="showTip(event, 'fs47', 267)" class="i">x</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs53', 268)" onmouseover="showTip(event, 'fs53', 268)" class="i">n</span>
  | <span onmouseout="hideTip(event, 'fs58', 269)" onmouseover="showTip(event, 'fs58', 269)" class="i">And</span> (<span onmouseout="hideTip(event, 'fs65', 270)" onmouseover="showTip(event, 'fs65', 270)" class="i">t1</span>,<span onmouseout="hideTip(event, 'fs66', 271)" onmouseover="showTip(event, 'fs66', 271)" class="i">t2</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs71', 272)" onmouseover="showTip(event, 'fs71', 272)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs65', 273)" onmouseover="showTip(event, 'fs65', 273)" class="i">t1</span> <span onmouseout="hideTip(event, 'fs47', 274)" onmouseover="showTip(event, 'fs47', 274)" class="i">x</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs71', 275)" onmouseover="showTip(event, 'fs71', 275)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs66', 276)" onmouseover="showTip(event, 'fs66', 276)" class="i">t2</span> <span onmouseout="hideTip(event, 'fs47', 277)" onmouseover="showTip(event, 'fs47', 277)" class="i">x</span>
  | <span onmouseout="hideTip(event, 'fs59', 278)" onmouseover="showTip(event, 'fs59', 278)" class="i">Or</span> (<span onmouseout="hideTip(event, 'fs65', 279)" onmouseover="showTip(event, 'fs65', 279)" class="i">t1</span>,<span onmouseout="hideTip(event, 'fs66', 280)" onmouseover="showTip(event, 'fs66', 280)" class="i">t2</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs71', 281)" onmouseover="showTip(event, 'fs71', 281)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs65', 282)" onmouseover="showTip(event, 'fs65', 282)" class="i">t1</span> <span onmouseout="hideTip(event, 'fs47', 283)" onmouseover="showTip(event, 'fs47', 283)" class="i">x</span> <span class="o">||</span> <span onmouseout="hideTip(event, 'fs71', 284)" onmouseover="showTip(event, 'fs71', 284)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs66', 285)" onmouseover="showTip(event, 'fs66', 285)" class="i">t2</span> <span onmouseout="hideTip(event, 'fs47', 286)" onmouseover="showTip(event, 'fs47', 286)" class="i">x</span> 
  | <span onmouseout="hideTip(event, 'fs60', 287)" onmouseover="showTip(event, 'fs60', 287)" class="i">Not</span> (<span onmouseout="hideTip(event, 'fs67', 288)" onmouseover="showTip(event, 'fs67', 288)" class="i">t0</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs68', 289)" onmouseover="showTip(event, 'fs68', 289)" class="i">not</span>(<span onmouseout="hideTip(event, 'fs71', 290)" onmouseover="showTip(event, 'fs71', 290)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs67', 291)" onmouseover="showTip(event, 'fs67', 291)" class="i">t0</span> <span onmouseout="hideTip(event, 'fs47', 292)" onmouseover="showTip(event, 'fs47', 292)" class="i">x</span>)

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 293)" onmouseover="showTip(event, 'fs72', 293)" class="i">ex6wrong</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 294)" onmouseover="showTip(event, 'fs3', 294)" class="i">query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 295)" onmouseover="showTip(event, 'fs35', 295)" class="i">Run</span> &lt;@ (<span class="o">%</span><span onmouseout="hideTip(event, 'fs44', 296)" onmouseover="showTip(event, 'fs44', 296)" class="i">satisfies</span>) (<span onmouseout="hideTip(event, 'fs71', 297)" onmouseover="showTip(event, 'fs71', 297)" class="i">wrongEval</span> <span onmouseout="hideTip(event, 'fs62', 298)" onmouseover="showTip(event, 'fs62', 298)" class="i">t1</span>) @&gt;</pre>
</td>
</tr>
</table>

<p>then we would run into the same problem as before, because we would be trying to run <code>satisfies</code> on quoted code containing 
recursive calls, which is not allowed.</p>

<h2>Queries over nested structures</h2>

<p>Even though the input data source and the output SQL query must be flat (i.e. tables of base types), 
we can make use of intermediate structures to represent the data and queries in a more readable fashion. 
The problem is that most often such queries are incredibly inefficient as compared to the 'simple version, 
their runtime bounded by the amount of records in the tables.</p>

<p><strong>FSharpComposableQuery</strong> guarantees us that <em>any</em> query which can be rewritten in such a way
as to generate a single SQL query, <em>will</em> be rewritten to it, as part of the normalisation process. 
It thus allows us to use nested structures without having to worry about any significant performance penalties.</p>

<p>For this example consider the simple database schema <code>Org</code> of an organisation 
with tables listing departments, the employees and their tasks:</p>

<pre><code>type Org = 
    {   departments : { dpt : string }                list;
        employees   : { dpt : string; emp : string }  list;
        tasks       : { emp : string; tsk : string }  list; }
</code></pre>

<p>Instead of declaring the type manually we will use the LINQ-to-SQL <code>TypeProvider</code> to get these directly from the database tables:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs73', 299)" onmouseover="showTip(event, 'fs73', 299)" class="i">dbSchema</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 300)" onmouseover="showTip(event, 'fs8', 300)" class="i">SqlDataConnection</span><span class="o">&lt;</span> <span class="i">ConnectionStringName</span><span class="o">=</span><span class="s">&quot;</span><span class="s">OrgConnectionString</span><span class="s">&quot;</span>, <span class="i">ConfigFile</span><span class="o">=</span><span class="s">&quot;</span><span class="s">db</span><span class="s">.</span><span class="s">config</span><span class="s">&quot;</span> <span class="o">&gt;</span>

<span class="k">let</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs74', 301)" onmouseover="showTip(event, 'fs74', 301)" class="i">orgDb</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 302)" onmouseover="showTip(event, 'fs73', 302)" class="i">dbSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs75', 303)" onmouseover="showTip(event, 'fs75', 303)" class="i">GetDataContext</span>()

<span class="k">type</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs76', 304)" onmouseover="showTip(event, 'fs76', 304)" class="i">Department</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 305)" onmouseover="showTip(event, 'fs73', 305)" class="i">dbSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 306)" onmouseover="showTip(event, 'fs77', 306)" class="i">ServiceTypes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs78', 307)" onmouseover="showTip(event, 'fs78', 307)" class="i">Departments</span>
<span class="k">type</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs79', 308)" onmouseover="showTip(event, 'fs79', 308)" class="i">Employee</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 309)" onmouseover="showTip(event, 'fs73', 309)" class="i">dbSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 310)" onmouseover="showTip(event, 'fs77', 310)" class="i">ServiceTypes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs80', 311)" onmouseover="showTip(event, 'fs80', 311)" class="i">Employees</span>
<span class="k">type</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs81', 312)" onmouseover="showTip(event, 'fs81', 312)" class="i">Contact</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 313)" onmouseover="showTip(event, 'fs73', 313)" class="i">dbSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 314)" onmouseover="showTip(event, 'fs77', 314)" class="i">ServiceTypes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs82', 315)" onmouseover="showTip(event, 'fs82', 315)" class="i">Contacts</span>
<span class="k">type</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs83', 316)" onmouseover="showTip(event, 'fs83', 316)" class="i">Task</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 317)" onmouseover="showTip(event, 'fs73', 317)" class="i">dbSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 318)" onmouseover="showTip(event, 'fs77', 318)" class="i">ServiceTypes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 319)" onmouseover="showTip(event, 'fs84', 319)" class="i">Tasks</span></pre>
</td>
</tr>
</table>

<p>As an example we are going to demonstrate a query which finds the departments where every employee can perform 
a given task.</p>

<p>The following parameterised query accomplishes this in a way similar to how one would write it in SQL:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs85', 320)" onmouseover="showTip(event, 'fs85', 320)" class="i">expertiseNaive</span> <span class="o">=</span>
    &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs86', 321)" onmouseover="showTip(event, 'fs86', 321)" class="i">u</span> <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs3', 322)" onmouseover="showTip(event, 'fs3', 322)" class="i">query</span> {
            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs87', 323)" onmouseover="showTip(event, 'fs87', 323)" class="i">d</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs74', 324)" onmouseover="showTip(event, 'fs74', 324)" class="i">orgDb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 325)" onmouseover="showTip(event, 'fs88', 325)" class="i">Departments</span> <span class="k">do</span>
                <span class="k">if</span> <span onmouseout="hideTip(event, 'fs68', 326)" onmouseover="showTip(event, 'fs68', 326)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs3', 327)" onmouseover="showTip(event, 'fs3', 327)" class="i">query</span> {
                            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs89', 328)" onmouseover="showTip(event, 'fs89', 328)" class="i">e</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs74', 329)" onmouseover="showTip(event, 'fs74', 329)" class="i">orgDb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 330)" onmouseover="showTip(event, 'fs90', 330)" class="i">Employees</span> <span class="k">do</span>
                                <span onmouseout="hideTip(event, 'fs91', 331)" onmouseover="showTip(event, 'fs91', 331)" class="k">exists</span> (<span onmouseout="hideTip(event, 'fs89', 332)" onmouseover="showTip(event, 'fs89', 332)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 333)" onmouseover="showTip(event, 'fs92', 333)" class="i">Dpt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs87', 334)" onmouseover="showTip(event, 'fs87', 334)" class="i">d</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 335)" onmouseover="showTip(event, 'fs93', 335)" class="i">Dpt</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs68', 336)" onmouseover="showTip(event, 'fs68', 336)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs3', 337)" onmouseover="showTip(event, 'fs3', 337)" class="i">query</span> {
                                                                    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs94', 338)" onmouseover="showTip(event, 'fs94', 338)" class="i">t</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs74', 339)" onmouseover="showTip(event, 'fs74', 339)" class="i">orgDb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs95', 340)" onmouseover="showTip(event, 'fs95', 340)" class="i">Tasks</span> <span class="k">do</span>
                                                                        <span onmouseout="hideTip(event, 'fs91', 341)" onmouseover="showTip(event, 'fs91', 341)" class="k">exists</span> (<span onmouseout="hideTip(event, 'fs89', 342)" onmouseover="showTip(event, 'fs89', 342)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs96', 343)" onmouseover="showTip(event, 'fs96', 343)" class="i">Emp</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs94', 344)" onmouseover="showTip(event, 'fs94', 344)" class="i">t</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 345)" onmouseover="showTip(event, 'fs97', 345)" class="i">Emp</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs94', 346)" onmouseover="showTip(event, 'fs94', 346)" class="i">t</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs98', 347)" onmouseover="showTip(event, 'fs98', 347)" class="i">Tsk</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs86', 348)" onmouseover="showTip(event, 'fs86', 348)" class="i">u</span>)
                                                                }))
                        })
                <span class="k">then</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs87', 349)" onmouseover="showTip(event, 'fs87', 349)" class="i">d</span>
        } @&gt;

<span class="k">let</span> <span class="k">internal</span> <span onmouseout="hideTip(event, 'fs99', 350)" onmouseover="showTip(event, 'fs99', 350)" class="i">ex8</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 351)" onmouseover="showTip(event, 'fs3', 351)" class="i">query</span> { <span class="k">yield!</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs85', 352)" onmouseover="showTip(event, 'fs85', 352)" class="i">expertiseNaive</span>) <span class="s">&quot;</span><span class="s">abstract</span><span class="s">&quot;</span> }</pre>
</td>
</tr>
</table>

<p>Note that even though the query is efficient and fairly readable, considering the given representation,
it is a single monolithic block which makes it difficult to read and maintain.</p>

<p>We will now show how the use of a nested data structure can help us formulate more readable queries.</p>

<p>To accomplish this we will first convert the existing relational structure to a nested one, where each 
<em>department</em> contains a list of <em>employees</em>, and each <em>employee</em> contains a list of <em>tasks</em>. 
Since these types are different to the types used in the relational schema, the <code>TypeProvider</code> is 
of no help here and we have to define them manually.</p>

<p>The resulting type <code>NestedOrg</code> is shown below:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs100', 353)" onmouseover="showTip(event, 'fs100', 353)" class="i">EmployeeTasks</span> <span class="o">=</span>
    { <span onmouseout="hideTip(event, 'fs101', 354)" onmouseover="showTip(event, 'fs101', 354)" class="i">emp</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs102', 355)" onmouseover="showTip(event, 'fs102', 355)" class="i">string</span>; <span onmouseout="hideTip(event, 'fs103', 356)" onmouseover="showTip(event, 'fs103', 356)" class="i">tasks</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs25', 357)" onmouseover="showTip(event, 'fs25', 357)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 358)" onmouseover="showTip(event, 'fs26', 358)" class="i">Linq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 359)" onmouseover="showTip(event, 'fs27', 359)" class="i">IQueryable</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs102', 360)" onmouseover="showTip(event, 'fs102', 360)" class="i">string</span><span class="o">&gt;</span> }

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs104', 361)" onmouseover="showTip(event, 'fs104', 361)" class="i">DepartmentEmployees</span> <span class="o">=</span>
    { <span onmouseout="hideTip(event, 'fs105', 362)" onmouseover="showTip(event, 'fs105', 362)" class="i">dpt</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs102', 363)" onmouseover="showTip(event, 'fs102', 363)" class="i">string</span>; <span onmouseout="hideTip(event, 'fs106', 364)" onmouseover="showTip(event, 'fs106', 364)" class="i">employees</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs25', 365)" onmouseover="showTip(event, 'fs25', 365)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 366)" onmouseover="showTip(event, 'fs26', 366)" class="i">Linq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 367)" onmouseover="showTip(event, 'fs27', 367)" class="i">IQueryable</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs100', 368)" onmouseover="showTip(event, 'fs100', 368)" class="i">EmployeeTasks</span><span class="o">&gt;</span> }

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs107', 369)" onmouseover="showTip(event, 'fs107', 369)" class="i">NestedOrg</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 370)" onmouseover="showTip(event, 'fs25', 370)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 371)" onmouseover="showTip(event, 'fs26', 371)" class="i">Linq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 372)" onmouseover="showTip(event, 'fs27', 372)" class="i">IQueryable</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs104', 373)" onmouseover="showTip(event, 'fs104', 373)" class="i">DepartmentEmployees</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

<p>Note the use of <code>IQueryable&lt;'T&gt;</code> instead of <code>seq</code> or <code>list</code> as it is the type all LINQ database operations
work with and return.</p>

<p>We can convert the source tables to the second format as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 374)" onmouseover="showTip(event, 'fs108', 374)" class="i">nestedDb</span> <span class="o">=</span>
    &lt;@ <span onmouseout="hideTip(event, 'fs3', 375)" onmouseover="showTip(event, 'fs3', 375)" class="i">query</span> {
            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs87', 376)" onmouseover="showTip(event, 'fs87', 376)" class="i">d</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs74', 377)" onmouseover="showTip(event, 'fs74', 377)" class="i">orgDb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 378)" onmouseover="showTip(event, 'fs88', 378)" class="i">Departments</span> <span class="k">do</span>                   <span class="c">// for each department d</span>
                <span class="k">yield</span> { <span class="i">dpt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs87', 379)" onmouseover="showTip(event, 'fs87', 379)" class="i">d</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 380)" onmouseover="showTip(event, 'fs93', 380)" class="i">Dpt</span>
                        <span class="i">employees</span> <span class="o">=</span>
                            <span onmouseout="hideTip(event, 'fs3', 381)" onmouseover="showTip(event, 'fs3', 381)" class="i">query</span> {
                                <span class="k">for</span> <span onmouseout="hideTip(event, 'fs89', 382)" onmouseover="showTip(event, 'fs89', 382)" class="i">e</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs74', 383)" onmouseover="showTip(event, 'fs74', 383)" class="i">orgDb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 384)" onmouseover="showTip(event, 'fs90', 384)" class="i">Employees</span> <span class="k">do</span> <span class="c">// add employees working in it</span>
                                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs87', 385)" onmouseover="showTip(event, 'fs87', 385)" class="i">d</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 386)" onmouseover="showTip(event, 'fs93', 386)" class="i">Dpt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 387)" onmouseover="showTip(event, 'fs89', 387)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 388)" onmouseover="showTip(event, 'fs92', 388)" class="i">Dpt</span> <span class="k">then</span>
                                        <span class="k">yield</span> { <span class="i">emp</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 389)" onmouseover="showTip(event, 'fs89', 389)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs96', 390)" onmouseover="showTip(event, 'fs96', 390)" class="i">Emp</span>
                                                <span class="i">tasks</span> <span class="o">=</span>     <span class="c">// each with the tasks assigned to him</span>
                                                    <span onmouseout="hideTip(event, 'fs3', 391)" onmouseover="showTip(event, 'fs3', 391)" class="i">query</span> {
                                                        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs94', 392)" onmouseover="showTip(event, 'fs94', 392)" class="i">t</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs74', 393)" onmouseover="showTip(event, 'fs74', 393)" class="i">orgDb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs95', 394)" onmouseover="showTip(event, 'fs95', 394)" class="i">Tasks</span> <span class="k">do</span>
                                                            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs94', 395)" onmouseover="showTip(event, 'fs94', 395)" class="i">t</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 396)" onmouseover="showTip(event, 'fs97', 396)" class="i">Emp</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 397)" onmouseover="showTip(event, 'fs89', 397)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs96', 398)" onmouseover="showTip(event, 'fs96', 398)" class="i">Emp</span> <span class="k">then</span> 
                                                                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs94', 399)" onmouseover="showTip(event, 'fs94', 399)" class="i">t</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs98', 400)" onmouseover="showTip(event, 'fs98', 400)" class="i">Tsk</span>
                                                    } }
                            } }
        } @&gt;</pre>
</td>
</tr>
</table>

<p>Even though we can evaluate the expression above using <code>query.Run</code> and directly query its contents,
each such query will surely generate a multitude of SQL queries - possibly one for every department and employee we
have to go through.</p>

<p>In most cases though, the queries we are interested in return "simple" data in the form of rows 
(or even a single value). Usually these queries can be written by hand in such a way as to generate a single, 
efficient SQL query; doing so also means one has to use the</p>

<p>and such queries can be rewritten in a way as to generate a single output SQL query. 
Note that we cannot evaluate <code>query.Run { yield! (%nestedOrg) }</code> because <code>query.Run</code> requires a flat argument,
and the return type of <code>nestedOrg</code> is nested. However, this nested structure becomes useful when used to 
formulate other queries.</p>

<p>For convenience we will now declare several higher-order queries. 
Note how we can easily express consecutive queries in terms of previous ones.</p>

<p>The first one takes a predicate and a list and returns whether the predicate holds for any item in the list:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs109', 401)" onmouseover="showTip(event, 'fs109', 401)" class="i">Microsoft</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs110', 402)" onmouseover="showTip(event, 'fs110', 402)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs111', 403)" onmouseover="showTip(event, 'fs111', 403)" class="i">Quotations</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs25', 404)" onmouseover="showTip(event, 'fs25', 404)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 405)" onmouseover="showTip(event, 'fs26', 405)" class="i">Linq</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 406)" onmouseover="showTip(event, 'fs112', 406)" class="i">any</span>() <span class="o">=</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs113', 407)" onmouseover="showTip(event, 'fs113', 407)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs114', 408)" onmouseover="showTip(event, 'fs114', 408)" class="i">p</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 409)" onmouseover="showTip(event, 'fs3', 409)" class="i">query</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs115', 410)" onmouseover="showTip(event, 'fs115', 410)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs113', 411)" onmouseover="showTip(event, 'fs113', 411)" class="i">xs</span> <span class="k">do</span> <span onmouseout="hideTip(event, 'fs91', 412)" onmouseover="showTip(event, 'fs91', 412)" class="k">exists</span> (<span onmouseout="hideTip(event, 'fs114', 413)" onmouseover="showTip(event, 'fs114', 413)" class="i">p</span> <span onmouseout="hideTip(event, 'fs115', 414)" onmouseover="showTip(event, 'fs115', 414)" class="i">x</span>) } @&gt;</pre>
</td>
</tr>
</table>

<p>The second takes a predicate and a list and returns whether the predicate holds for all items in the list:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 415)" onmouseover="showTip(event, 'fs116', 415)" class="i">forallA</span>() <span class="o">=</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs113', 416)" onmouseover="showTip(event, 'fs113', 416)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs114', 417)" onmouseover="showTip(event, 'fs114', 417)" class="i">p</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs68', 418)" onmouseover="showTip(event, 'fs68', 418)" class="i">not</span> ((<span class="o">%</span><span onmouseout="hideTip(event, 'fs112', 419)" onmouseover="showTip(event, 'fs112', 419)" class="i">any</span>()) <span onmouseout="hideTip(event, 'fs113', 420)" onmouseover="showTip(event, 'fs113', 420)" class="i">xs</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs115', 421)" onmouseover="showTip(event, 'fs115', 421)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs68', 422)" onmouseover="showTip(event, 'fs68', 422)" class="i">not</span>(<span onmouseout="hideTip(event, 'fs114', 423)" onmouseover="showTip(event, 'fs114', 423)" class="i">p</span> <span onmouseout="hideTip(event, 'fs115', 424)" onmouseover="showTip(event, 'fs115', 424)" class="i">x</span>))) @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs117', 425)" onmouseover="showTip(event, 'fs117', 425)" class="i">forallB</span>() <span class="o">=</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs113', 426)" onmouseover="showTip(event, 'fs113', 426)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs114', 427)" onmouseover="showTip(event, 'fs114', 427)" class="i">p</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 428)" onmouseover="showTip(event, 'fs3', 428)" class="i">query</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs115', 429)" onmouseover="showTip(event, 'fs115', 429)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs113', 430)" onmouseover="showTip(event, 'fs113', 430)" class="i">xs</span> <span class="k">do</span> <span onmouseout="hideTip(event, 'fs118', 431)" onmouseover="showTip(event, 'fs118', 431)" class="k">all</span>(<span onmouseout="hideTip(event, 'fs114', 432)" onmouseover="showTip(event, 'fs114', 432)" class="i">p</span> <span onmouseout="hideTip(event, 'fs115', 433)" onmouseover="showTip(event, 'fs115', 433)" class="i">x</span>) } @&gt;</pre>
</td>
</tr>
</table>

<p>The third one takes a value and a list and returns whether the value occurs in the list:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 434)" onmouseover="showTip(event, 'fs119', 434)" class="i">containsA</span>() <span class="o">=</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs120', 435)" onmouseover="showTip(event, 'fs120', 435)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs121', 436)" onmouseover="showTip(event, 'fs121', 436)" class="i">u</span> <span class="k">-&gt;</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs112', 437)" onmouseover="showTip(event, 'fs112', 437)" class="i">any</span>()) <span onmouseout="hideTip(event, 'fs120', 438)" onmouseover="showTip(event, 'fs120', 438)" class="i">xs</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs122', 439)" onmouseover="showTip(event, 'fs122', 439)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs122', 440)" onmouseover="showTip(event, 'fs122', 440)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs121', 441)" onmouseover="showTip(event, 'fs121', 441)" class="i">u</span>) @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs123', 442)" onmouseover="showTip(event, 'fs123', 442)" class="i">containsB</span>() <span class="o">=</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs120', 443)" onmouseover="showTip(event, 'fs120', 443)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs121', 444)" onmouseover="showTip(event, 'fs121', 444)" class="i">u</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs68', 445)" onmouseover="showTip(event, 'fs68', 445)" class="i">not</span> ((<span class="o">%</span><span onmouseout="hideTip(event, 'fs116', 446)" onmouseover="showTip(event, 'fs116', 446)" class="i">forallA</span>()) <span onmouseout="hideTip(event, 'fs120', 447)" onmouseover="showTip(event, 'fs120', 447)" class="i">xs</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs122', 448)" onmouseover="showTip(event, 'fs122', 448)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs122', 449)" onmouseover="showTip(event, 'fs122', 449)" class="i">x</span> <span class="o">&lt;&gt;</span> <span onmouseout="hideTip(event, 'fs121', 450)" onmouseover="showTip(event, 'fs121', 450)" class="i">u</span>)) @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs124', 451)" onmouseover="showTip(event, 'fs124', 451)" class="i">containsC</span>() <span class="o">=</span> &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs113', 452)" onmouseover="showTip(event, 'fs113', 452)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs125', 453)" onmouseover="showTip(event, 'fs125', 453)" class="i">u</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 454)" onmouseover="showTip(event, 'fs3', 454)" class="i">query</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs115', 455)" onmouseover="showTip(event, 'fs115', 455)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs113', 456)" onmouseover="showTip(event, 'fs113', 456)" class="i">xs</span> <span class="k">do</span> <span onmouseout="hideTip(event, 'fs126', 457)" onmouseover="showTip(event, 'fs126', 457)" class="k">contains</span> <span onmouseout="hideTip(event, 'fs125', 458)" onmouseover="showTip(event, 'fs125', 458)" class="i">u</span> } @&gt;</pre>
</td>
</tr>
</table>

<p>The above queries, although defined in different terms, all produce the same efficient SQL output 
when used with the <strong>FSharpComposableQuery</strong> library.</p>

<p>We can now define and execute a query, equivalent to <code>expertiseNaive</code>, using those three operators and the nested structure
we created earlier:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs127', 459)" onmouseover="showTip(event, 'fs127', 459)" class="i">expertise</span> <span class="o">=</span>
    &lt;@ <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs86', 460)" onmouseover="showTip(event, 'fs86', 460)" class="i">u</span> <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs3', 461)" onmouseover="showTip(event, 'fs3', 461)" class="i">query</span> {
            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs128', 462)" onmouseover="showTip(event, 'fs128', 462)" class="i">d</span> <span class="k">in</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs129', 463)" onmouseover="showTip(event, 'fs129', 463)" class="i">nestedDb</span>) <span class="k">do</span>
                <span class="k">if</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs116', 464)" onmouseover="showTip(event, 'fs116', 464)" class="i">forallA</span>()) (<span onmouseout="hideTip(event, 'fs128', 465)" onmouseover="showTip(event, 'fs128', 465)" class="i">d</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs130', 466)" onmouseover="showTip(event, 'fs130', 466)" class="i">employees</span>) (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs131', 467)" onmouseover="showTip(event, 'fs131', 467)" class="i">e</span> <span class="k">-&gt;</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs119', 468)" onmouseover="showTip(event, 'fs119', 468)" class="i">containsA</span>()) <span onmouseout="hideTip(event, 'fs131', 469)" onmouseover="showTip(event, 'fs131', 469)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs132', 470)" onmouseover="showTip(event, 'fs132', 470)" class="i">tasks</span> <span onmouseout="hideTip(event, 'fs86', 471)" onmouseover="showTip(event, 'fs86', 471)" class="i">u</span>) <span class="k">then</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs128', 472)" onmouseover="showTip(event, 'fs128', 472)" class="i">d</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 473)" onmouseover="showTip(event, 'fs105', 473)" class="i">dpt</span>
        } @&gt;

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 474)" onmouseover="showTip(event, 'fs133', 474)" class="i">ex9</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 475)" onmouseover="showTip(event, 'fs3', 475)" class="i">query</span> { <span class="k">yield!</span> (<span class="o">%</span><span onmouseout="hideTip(event, 'fs127', 476)" onmouseover="showTip(event, 'fs127', 476)" class="i">expertise</span>) <span class="s">&quot;</span><span class="s">abstract</span><span class="s">&quot;</span> }</pre>
</td>
</tr>
</table>

<p>yields the same query as in the previous example (8).</p>

<p>Note that it is still possible to run these queries using the default QueryBuilder.
It is simply that such queries operating on nested types may and will cause the default QueryBuilder to output a multitude
of SQL queries roughly proportional to the amount of rows in the tables involved since it does not try
to simplify (normalise) the expressions inside the query.</p>

<p>This is what the <strong>FSharpComposableQuery</strong> library accomplishes in such cases. 
It provides a strong guarantee on the number of generated SQL queries: it always outputs a single SQL query for all inputs
which can be transformed to such a form.</p>

<p>You can observe the difference in the execution time of <code>ex9</code> as parsed by the default and the <strong>FSharpComposableQuery</strong> 
builders by running the tests from the <code>Nested.fs</code> file in the Tests project. In the case of 5000 employees and 500 
departments the query as executed by the first builder takes significantly more time than the second.</p>

<div class="tip" id="fs1">val data : int list<br /><br />Full name: Tutorial.data</div>
<div class="tip" id="fs2">val lastNumberInSortedList : int<br /><br />Full name: Tutorial.lastNumberInSortedList</div>
<div class="tip" id="fs3">val query : QueryImpl.QueryBuilder<br /><br />Full name: FSharpComposableQuery.TopLevelValues.query</div>
<div class="tip" id="fs4">val s : int</div>
<div class="tip" id="fs5">custom operation: sortBy (&#39;Key)<br /><br />Calls Linq.QueryBuilder.SortBy </div>
<div class="tip" id="fs6">custom operation: last<br /><br />Calls Linq.QueryBuilder.Last </div>
<div class="tip" id="fs7">type dbPeople =<br />&#160;&#160;static member GetDataContext : unit -&gt; MyPeople + 1 overload<br />&#160;&#160;nested type ServiceTypes<br /><br />Full name: Tutorial.dbPeople<br /><em><br /><br />&lt;summary&gt;Provides the types to access a database, using a LINQ-to-SQL mapping&lt;/summary&gt;&lt;param name=&#39;ConnectionString&#39;&gt;The connection string for the database connection. If using Visual Studio, a connection string can be found in database properties in the Server Explorer window.&lt;/param&gt;&lt;param name=&#39;ConnectionStringName&#39;&gt;The name of the connection string for the database connection in the configuration file.&lt;/param&gt;&lt;param name=&#39;LocalSchemaFile&#39;&gt;The local .dbml file for the database schema (default: no local schema file)&lt;/param&gt;&lt;param name=&#39;ForceUpdate&#39;&gt;Require that a direct connection to the database be available at design-time and force the refresh of the local schema file (default: true)&lt;/param&gt;&lt;param name=&#39;Pluralize&#39;&gt;Automatically pluralize or singularize class and member names using English language rules (default: false)&lt;/param&gt;&lt;param name=&#39;Views&#39;&gt;Extract database views (default: true)&lt;/param&gt;&lt;param name=&#39;Functions&#39;&gt;Extract database functions (default: true)&lt;/param&gt;&lt;param name=&#39;ConfigFile&#39;&gt;The name of the configuration file used for connection strings (default: app.config or web.config is used)&lt;/param&gt;&lt;param name=&#39;DataDirectory&#39;&gt;The name of the data directory, used to replace |DataDirectory| in connection strings (default: the project or script directory)&lt;/param&gt;&lt;param name=&#39;ResolutionFolder&#39;&gt;The folder used to resolve relative file paths at compile-time (default: folder containing the project or script)&lt;/param&gt;&lt;param name=&#39;StoredProcedures&#39;&gt;Extract stored procedures (default: true)&lt;/param&gt;&lt;param name=&#39;Timeout&#39;&gt;Timeout value in seconds to use when SqlMetal accesses the database (default: 0, which means infinite)&lt;/param&gt;&lt;param name=&#39;ContextTypeName&#39;&gt;The name of data context class (default: derived from database name)&lt;/param&gt;&lt;param name=&#39;Serializable&#39;&gt;Generate uni-directional serializable classes (default: false, which means no serialization)&lt;/param&gt;</em></div>
<div class="tip" id="fs8">type SqlDataConnection<br /><br />Full name: Microsoft.FSharp.Data.TypeProviders.SqlDataConnection<br /><em><br /><br />&lt;summary&gt;Provides the types to access a database, using a LINQ-to-SQL mapping&lt;/summary&gt;&lt;param name=&#39;ConnectionString&#39;&gt;The connection string for the database connection. If using Visual Studio, a connection string can be found in database properties in the Server Explorer window.&lt;/param&gt;&lt;param name=&#39;ConnectionStringName&#39;&gt;The name of the connection string for the database connection in the configuration file.&lt;/param&gt;&lt;param name=&#39;LocalSchemaFile&#39;&gt;The local .dbml file for the database schema (default: no local schema file)&lt;/param&gt;&lt;param name=&#39;ForceUpdate&#39;&gt;Require that a direct connection to the database be available at design-time and force the refresh of the local schema file (default: true)&lt;/param&gt;&lt;param name=&#39;Pluralize&#39;&gt;Automatically pluralize or singularize class and member names using English language rules (default: false)&lt;/param&gt;&lt;param name=&#39;Views&#39;&gt;Extract database views (default: true)&lt;/param&gt;&lt;param name=&#39;Functions&#39;&gt;Extract database functions (default: true)&lt;/param&gt;&lt;param name=&#39;ConfigFile&#39;&gt;The name of the configuration file used for connection strings (default: app.config or web.config is used)&lt;/param&gt;&lt;param name=&#39;DataDirectory&#39;&gt;The name of the data directory, used to replace |DataDirectory| in connection strings (default: the project or script directory)&lt;/param&gt;&lt;param name=&#39;ResolutionFolder&#39;&gt;The folder used to resolve relative file paths at compile-time (default: folder containing the project or script)&lt;/param&gt;&lt;param name=&#39;StoredProcedures&#39;&gt;Extract stored procedures (default: true)&lt;/param&gt;&lt;param name=&#39;Timeout&#39;&gt;Timeout value in seconds to use when SqlMetal accesses the database (default: 0, which means infinite)&lt;/param&gt;&lt;param name=&#39;ContextTypeName&#39;&gt;The name of data context class (default: derived from database name)&lt;/param&gt;&lt;param name=&#39;Serializable&#39;&gt;Generate uni-directional serializable classes (default: false, which means no serialization)&lt;/param&gt;</em></div>
<div class="tip" id="fs9">val db : dbPeople.ServiceTypes.SimpleDataContextTypes.MyPeople<br /><br />Full name: Tutorial.db</div>
<div class="tip" id="fs10">dbPeople.GetDataContext() : dbPeople.ServiceTypes.SimpleDataContextTypes.MyPeople<br /><em><br /><br />Get a simplified data context for this SQL connection. By default, no credentials are set</em><br />dbPeople.GetDataContext(connectionString: string) : dbPeople.ServiceTypes.SimpleDataContextTypes.MyPeople<br /><em><br /><br />Get a simplified data context for this SQL connection. By default, no credentials are set</em></div>
<div class="tip" id="fs11">type Person = dbPeople.ServiceTypes.People<br /><br />Full name: Tutorial.Person</div>
<div class="tip" id="fs12">type ServiceTypes =<br />&#160;&#160;nested type Couples<br />&#160;&#160;nested type MyPeople<br />&#160;&#160;nested type People<br />&#160;&#160;nested type SimpleDataContextTypes<br /><br />Full name: Tutorial.dbPeople.ServiceTypes<br /><em><br /><br />&lt;summary&gt;&lt;para&gt;The full API to the SQL connection.&lt;/para&gt;&lt;para&gt;To use the service via the full API, create an instance of one of the types &#39;MyPeople&#39;.&lt;/para&gt;&lt;/summary&gt;</em></div>
<div class="tip" id="fs13">type People =<br />&#160;&#160;interface INotifyPropertyChanging<br />&#160;&#160;interface INotifyPropertyChanged<br />&#160;&#160;new : unit -&gt; People<br />&#160;&#160;member Age : int with get, set<br />&#160;&#160;member Name : string with get, set<br />&#160;&#160;event PropertyChanged : PropertyChangedEventHandler<br />&#160;&#160;event PropertyChanging : PropertyChangingEventHandler<br /><br />Full name: Tutorial.dbPeople.ServiceTypes.People</div>
<div class="tip" id="fs14">val range1 : a:int -&gt; b:int -&gt; System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.range1</div>
<div class="tip" id="fs15">val a : int</div>
<div class="tip" id="fs16">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs17">val b : int</div>
<div class="tip" id="fs18">val u : dbPeople.ServiceTypes.People</div>
<div class="tip" id="fs19">property dbPeople.ServiceTypes.SimpleDataContextTypes.MyPeople.People: System.Data.Linq.Table&lt;dbPeople.ServiceTypes.People&gt;<br /><em><br /><br />Gets the &#39;People&#39; entities from the SQL connection. This property may be used as the source in a query expression.</em></div>
<div class="tip" id="fs20">property dbPeople.ServiceTypes.People.Age: int</div>
<div class="tip" id="fs21">val ex1 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex1</div>
<div class="tip" id="fs22">val range : Quotations.Expr&lt;(int -&gt; int -&gt; System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;)&gt;<br /><br />Full name: Tutorial.range</div>
<div class="tip" id="fs23">val ex2 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex2</div>
<div class="tip" id="fs24">val ex2wrong : System.Linq.IQueryable&lt;Person&gt;<br /><br />Full name: Tutorial.ex2wrong</div>
<div class="tip" id="fs25">namespace System</div>
<div class="tip" id="fs26">namespace System.Linq</div>
<div class="tip" id="fs27">Multiple items<br />type IQueryable =<br />&#160;&#160;member ElementType : Type<br />&#160;&#160;member Expression : Expression<br />&#160;&#160;member Provider : IQueryProvider<br /><br />Full name: System.Linq.IQueryable<br /><br />--------------------<br />type IQueryable&lt;&#39;T&gt; =<br /><br />Full name: System.Linq.IQueryable&lt;_&gt;</div>
<div class="tip" id="fs28">val ex2again : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex2again</div>
<div class="tip" id="fs29">val ex2again&#39; : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex2again&#39;</div>
<div class="tip" id="fs30">val x : dbPeople.ServiceTypes.People</div>
<div class="tip" id="fs31">val countRange : Quotations.Expr&lt;(int -&gt; int -&gt; int)&gt;<br /><br />Full name: Tutorial.countRange</div>
<div class="tip" id="fs32">custom operation: count<br /><br />Calls Linq.QueryBuilder.Count </div>
<div class="tip" id="fs33">val countWrong : System.Linq.IQueryable&lt;int&gt;<br /><br />Full name: Tutorial.countWrong</div>
<div class="tip" id="fs34">val countCorrect : int<br /><br />Full name: Tutorial.countCorrect</div>
<div class="tip" id="fs35">member Linq.QueryBuilder.Run : Quotations.Expr&lt;&#39;T&gt; -&gt; &#39;T<br />member Linq.QueryBuilder.Run : Quotations.Expr&lt;Linq.QuerySource&lt;&#39;T,System.Collections.IEnumerable&gt;&gt; -&gt; seq&lt;&#39;T&gt;<br />member QueryImpl.QueryBuilder.Run : q:Quotations.Expr&lt;&#39;T&gt; -&gt; &#39;T<br />member QueryImpl.QueryBuilder.Run : q:Quotations.Expr&lt;Linq.QuerySource&lt;&#39;T,System.Collections.IEnumerable&gt;&gt; -&gt; seq&lt;&#39;T&gt;<br />member QueryImpl.QueryBuilder.Run : q:Quotations.Expr&lt;Linq.QuerySource&lt;&#39;T,System.Linq.IQueryable&gt;&gt; -&gt; System.Linq.IQueryable&lt;&#39;T&gt;</div>
<div class="tip" id="fs36">val composeMonolithic : Quotations.Expr&lt;(string -&gt; string -&gt; System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;)&gt;<br /><br />Full name: Tutorial.composeMonolithic</div>
<div class="tip" id="fs37">val s : string</div>
<div class="tip" id="fs38">val t : string</div>
<div class="tip" id="fs39">val u1 : dbPeople.ServiceTypes.People</div>
<div class="tip" id="fs40">val u2 : dbPeople.ServiceTypes.People</div>
<div class="tip" id="fs41">property dbPeople.ServiceTypes.People.Name: string</div>
<div class="tip" id="fs42">val ageFromName : Quotations.Expr&lt;(string -&gt; System.Linq.IQueryable&lt;int&gt;)&gt;<br /><br />Full name: Tutorial.ageFromName</div>
<div class="tip" id="fs43">val compose : Quotations.Expr&lt;(string -&gt; string -&gt; System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;)&gt;<br /><br />Full name: Tutorial.compose</div>
<div class="tip" id="fs44">val satisfies : Quotations.Expr&lt;((int -&gt; bool) -&gt; System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;)&gt;<br /><br />Full name: Tutorial.satisfies</div>
<div class="tip" id="fs45">val p : (int -&gt; bool)</div>
<div class="tip" id="fs46">val ex3 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex3</div>
<div class="tip" id="fs47">val x : int</div>
<div class="tip" id="fs48">val ex4 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex4</div>
<div class="tip" id="fs49">val wrong1 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.wrong1</div>
<div class="tip" id="fs50">val age : int</div>
<div class="tip" id="fs51">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs52">val even : n:int -&gt; bool<br /><br />Full name: Tutorial.even</div>
<div class="tip" id="fs53">val n : int</div>
<div class="tip" id="fs54">val wrong2 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.wrong2</div>
<div class="tip" id="fs55">type Predicate =<br />&#160;&#160;| Above of int<br />&#160;&#160;| Below of int<br />&#160;&#160;| And of Predicate * Predicate<br />&#160;&#160;| Or of Predicate * Predicate<br />&#160;&#160;| Not of Predicate<br /><br />Full name: Tutorial.Predicate</div>
<div class="tip" id="fs56">union case Predicate.Above: int -&gt; Predicate</div>
<div class="tip" id="fs57">union case Predicate.Below: int -&gt; Predicate</div>
<div class="tip" id="fs58">union case Predicate.And: Predicate * Predicate -&gt; Predicate</div>
<div class="tip" id="fs59">union case Predicate.Or: Predicate * Predicate -&gt; Predicate</div>
<div class="tip" id="fs60">union case Predicate.Not: Predicate -&gt; Predicate</div>
<div class="tip" id="fs61">val t0 : Predicate<br /><br />Full name: Tutorial.t0</div>
<div class="tip" id="fs62">val t1 : Predicate<br /><br />Full name: Tutorial.t1</div>
<div class="tip" id="fs63">val eval : t:Predicate -&gt; Quotations.Expr&lt;(int -&gt; bool)&gt;<br /><br />Full name: Tutorial.eval</div>
<div class="tip" id="fs64">val t : Predicate</div>
<div class="tip" id="fs65">val t1 : Predicate</div>
<div class="tip" id="fs66">val t2 : Predicate</div>
<div class="tip" id="fs67">val t0 : Predicate</div>
<div class="tip" id="fs68">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs69">val ex6 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex6</div>
<div class="tip" id="fs70">val ex7 : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex7</div>
<div class="tip" id="fs71">val wrongEval : t:Predicate -&gt; x:int -&gt; bool<br /><br />Full name: Tutorial.wrongEval</div>
<div class="tip" id="fs72">val ex6wrong : System.Linq.IQueryable&lt;dbPeople.ServiceTypes.People&gt;<br /><br />Full name: Tutorial.ex6wrong</div>
<div class="tip" id="fs73">type internal dbSchema =<br />&#160;&#160;static member GetDataContext : unit -&gt; Organisation + 1 overload<br />&#160;&#160;nested type ServiceTypes<br /><br />Full name: Tutorial.dbSchema<br /><em><br /><br />&lt;summary&gt;Provides the types to access a database, using a LINQ-to-SQL mapping&lt;/summary&gt;&lt;param name=&#39;ConnectionString&#39;&gt;The connection string for the database connection. If using Visual Studio, a connection string can be found in database properties in the Server Explorer window.&lt;/param&gt;&lt;param name=&#39;ConnectionStringName&#39;&gt;The name of the connection string for the database connection in the configuration file.&lt;/param&gt;&lt;param name=&#39;LocalSchemaFile&#39;&gt;The local .dbml file for the database schema (default: no local schema file)&lt;/param&gt;&lt;param name=&#39;ForceUpdate&#39;&gt;Require that a direct connection to the database be available at design-time and force the refresh of the local schema file (default: true)&lt;/param&gt;&lt;param name=&#39;Pluralize&#39;&gt;Automatically pluralize or singularize class and member names using English language rules (default: false)&lt;/param&gt;&lt;param name=&#39;Views&#39;&gt;Extract database views (default: true)&lt;/param&gt;&lt;param name=&#39;Functions&#39;&gt;Extract database functions (default: true)&lt;/param&gt;&lt;param name=&#39;ConfigFile&#39;&gt;The name of the configuration file used for connection strings (default: app.config or web.config is used)&lt;/param&gt;&lt;param name=&#39;DataDirectory&#39;&gt;The name of the data directory, used to replace |DataDirectory| in connection strings (default: the project or script directory)&lt;/param&gt;&lt;param name=&#39;ResolutionFolder&#39;&gt;The folder used to resolve relative file paths at compile-time (default: folder containing the project or script)&lt;/param&gt;&lt;param name=&#39;StoredProcedures&#39;&gt;Extract stored procedures (default: true)&lt;/param&gt;&lt;param name=&#39;Timeout&#39;&gt;Timeout value in seconds to use when SqlMetal accesses the database (default: 0, which means infinite)&lt;/param&gt;&lt;param name=&#39;ContextTypeName&#39;&gt;The name of data context class (default: derived from database name)&lt;/param&gt;&lt;param name=&#39;Serializable&#39;&gt;Generate uni-directional serializable classes (default: false, which means no serialization)&lt;/param&gt;</em></div>
<div class="tip" id="fs74">val internal orgDb : dbSchema.ServiceTypes.SimpleDataContextTypes.Organisation<br /><br />Full name: Tutorial.orgDb</div>
<div class="tip" id="fs75">dbSchema.GetDataContext() : dbSchema.ServiceTypes.SimpleDataContextTypes.Organisation<br /><em><br /><br />Get a simplified data context for this SQL connection. By default, no credentials are set</em><br />dbSchema.GetDataContext(connectionString: string) : dbSchema.ServiceTypes.SimpleDataContextTypes.Organisation<br /><em><br /><br />Get a simplified data context for this SQL connection. By default, no credentials are set</em></div>
<div class="tip" id="fs76">type internal Department = dbSchema.ServiceTypes.Departments<br /><br />Full name: Tutorial.Department</div>
<div class="tip" id="fs77">type internal ServiceTypes =<br />&#160;&#160;nested type Contacts<br />&#160;&#160;nested type Departments<br />&#160;&#160;nested type Employees<br />&#160;&#160;nested type Organisation<br />&#160;&#160;nested type SimpleDataContextTypes<br />&#160;&#160;nested type Tasks<br /><br />Full name: Tutorial.dbSchema.ServiceTypes<br /><em><br /><br />&lt;summary&gt;&lt;para&gt;The full API to the SQL connection.&lt;/para&gt;&lt;para&gt;To use the service via the full API, create an instance of one of the types &#39;Organisation&#39;.&lt;/para&gt;&lt;/summary&gt;</em></div>
<div class="tip" id="fs78">type internal Departments =<br />&#160;&#160;interface INotifyPropertyChanging<br />&#160;&#160;interface INotifyPropertyChanged<br />&#160;&#160;new : unit -&gt; Departments<br />&#160;&#160;member Dpt : string with get, set<br />&#160;&#160;event PropertyChanged : PropertyChangedEventHandler<br />&#160;&#160;event PropertyChanging : PropertyChangingEventHandler<br /><br />Full name: Tutorial.dbSchema.ServiceTypes.Departments</div>
<div class="tip" id="fs79">type internal Employee = dbSchema.ServiceTypes.Employees<br /><br />Full name: Tutorial.Employee</div>
<div class="tip" id="fs80">type internal Employees =<br />&#160;&#160;interface INotifyPropertyChanging<br />&#160;&#160;interface INotifyPropertyChanged<br />&#160;&#160;new : unit -&gt; Employees<br />&#160;&#160;member Dpt : string with get, set<br />&#160;&#160;member Emp : string with get, set<br />&#160;&#160;event PropertyChanged : PropertyChangedEventHandler<br />&#160;&#160;event PropertyChanging : PropertyChangingEventHandler<br />&#160;&#160;member Salary : int with get, set<br /><br />Full name: Tutorial.dbSchema.ServiceTypes.Employees</div>
<div class="tip" id="fs81">type internal Contact = dbSchema.ServiceTypes.Contacts<br /><br />Full name: Tutorial.Contact</div>
<div class="tip" id="fs82">type internal Contacts =<br />&#160;&#160;interface INotifyPropertyChanging<br />&#160;&#160;interface INotifyPropertyChanged<br />&#160;&#160;new : unit -&gt; Contacts<br />&#160;&#160;member Client : int with get, set<br />&#160;&#160;member Contact : string with get, set<br />&#160;&#160;member Dpt : string with get, set<br />&#160;&#160;event PropertyChanged : PropertyChangedEventHandler<br />&#160;&#160;event PropertyChanging : PropertyChangingEventHandler<br /><br />Full name: Tutorial.dbSchema.ServiceTypes.Contacts</div>
<div class="tip" id="fs83">type internal Task = dbSchema.ServiceTypes.Tasks<br /><br />Full name: Tutorial.Task</div>
<div class="tip" id="fs84">type internal Tasks =<br />&#160;&#160;interface INotifyPropertyChanging<br />&#160;&#160;interface INotifyPropertyChanged<br />&#160;&#160;new : unit -&gt; Tasks<br />&#160;&#160;member Emp : string with get, set<br />&#160;&#160;event PropertyChanged : PropertyChangedEventHandler<br />&#160;&#160;event PropertyChanging : PropertyChangingEventHandler<br />&#160;&#160;member Tsk : string with get, set<br /><br />Full name: Tutorial.dbSchema.ServiceTypes.Tasks</div>
<div class="tip" id="fs85">val internal expertiseNaive : Quotations.Expr&lt;(string -&gt; System.Linq.IQueryable&lt;dbSchema.ServiceTypes.Departments&gt;)&gt;<br /><br />Full name: Tutorial.expertiseNaive</div>
<div class="tip" id="fs86">val u : string</div>
<div class="tip" id="fs87">val d : dbSchema.ServiceTypes.Departments</div>
<div class="tip" id="fs88">property dbSchema.ServiceTypes.SimpleDataContextTypes.Organisation.Departments: System.Data.Linq.Table&lt;dbSchema.ServiceTypes.Departments&gt;<br /><em><br /><br />Gets the &#39;Departments&#39; entities from the SQL connection. This property may be used as the source in a query expression.</em></div>
<div class="tip" id="fs89">val e : dbSchema.ServiceTypes.Employees</div>
<div class="tip" id="fs90">property dbSchema.ServiceTypes.SimpleDataContextTypes.Organisation.Employees: System.Data.Linq.Table&lt;dbSchema.ServiceTypes.Employees&gt;<br /><em><br /><br />Gets the &#39;Employees&#39; entities from the SQL connection. This property may be used as the source in a query expression.</em></div>
<div class="tip" id="fs91">custom operation: exists (bool)<br /><br />Calls Linq.QueryBuilder.Exists </div>
<div class="tip" id="fs92">property dbSchema.ServiceTypes.Employees.Dpt: string</div>
<div class="tip" id="fs93">property dbSchema.ServiceTypes.Departments.Dpt: string</div>
<div class="tip" id="fs94">val t : dbSchema.ServiceTypes.Tasks</div>
<div class="tip" id="fs95">property dbSchema.ServiceTypes.SimpleDataContextTypes.Organisation.Tasks: System.Data.Linq.Table&lt;dbSchema.ServiceTypes.Tasks&gt;<br /><em><br /><br />Gets the &#39;Tasks&#39; entities from the SQL connection. This property may be used as the source in a query expression.</em></div>
<div class="tip" id="fs96">property dbSchema.ServiceTypes.Employees.Emp: string</div>
<div class="tip" id="fs97">property dbSchema.ServiceTypes.Tasks.Emp: string</div>
<div class="tip" id="fs98">property dbSchema.ServiceTypes.Tasks.Tsk: string</div>
<div class="tip" id="fs99">val internal ex8 : System.Linq.IQueryable&lt;dbSchema.ServiceTypes.Departments&gt;<br /><br />Full name: Tutorial.ex8</div>
<div class="tip" id="fs100">type EmployeeTasks =<br />&#160;&#160;{emp: string;<br />&#160;&#160;&#160;tasks: IQueryable&lt;string&gt;;}<br /><br />Full name: Tutorial.EmployeeTasks</div>
<div class="tip" id="fs101">EmployeeTasks.emp: string</div>
<div class="tip" id="fs102">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs103">EmployeeTasks.tasks: System.Linq.IQueryable&lt;string&gt;</div>
<div class="tip" id="fs104">type DepartmentEmployees =<br />&#160;&#160;{dpt: string;<br />&#160;&#160;&#160;employees: IQueryable&lt;EmployeeTasks&gt;;}<br /><br />Full name: Tutorial.DepartmentEmployees</div>
<div class="tip" id="fs105">DepartmentEmployees.dpt: string</div>
<div class="tip" id="fs106">DepartmentEmployees.employees: System.Linq.IQueryable&lt;EmployeeTasks&gt;</div>
<div class="tip" id="fs107">type NestedOrg = System.Linq.IQueryable&lt;DepartmentEmployees&gt;<br /><br />Full name: Tutorial.NestedOrg</div>
<div class="tip" id="fs108">val nestedDb : Quotations.Expr&lt;System.Linq.IQueryable&lt;DepartmentEmployees&gt;&gt;<br /><br />Full name: Tutorial.nestedDb</div>
<div class="tip" id="fs109">namespace Microsoft</div>
<div class="tip" id="fs110">namespace Microsoft.FSharp</div>
<div class="tip" id="fs111">namespace Microsoft.FSharp.Quotations</div>
<div class="tip" id="fs112">val any : unit -&gt; Expr&lt;(#IQueryable&lt;&#39;b&gt; -&gt; (&#39;b -&gt; bool) -&gt; bool)&gt;<br /><br />Full name: Tutorial.any</div>
<div class="tip" id="fs113">val xs : #IQueryable&lt;&#39;b&gt;</div>
<div class="tip" id="fs114">val p : (&#39;b -&gt; bool)</div>
<div class="tip" id="fs115">val x : &#39;b</div>
<div class="tip" id="fs116">val forallA : unit -&gt; Expr&lt;(#IQueryable&lt;&#39;b&gt; -&gt; (&#39;b -&gt; bool) -&gt; bool)&gt;<br /><br />Full name: Tutorial.forallA</div>
<div class="tip" id="fs117">val forallB : unit -&gt; Expr&lt;(#IQueryable&lt;&#39;b&gt; -&gt; (&#39;b -&gt; bool) -&gt; bool)&gt;<br /><br />Full name: Tutorial.forallB</div>
<div class="tip" id="fs118">custom operation: all (bool)<br /><br />Calls Linq.QueryBuilder.All </div>
<div class="tip" id="fs119">val containsA : unit -&gt; Expr&lt;(#IQueryable&lt;&#39;b&gt; -&gt; &#39;b -&gt; bool)&gt; (requires equality)<br /><br />Full name: Tutorial.containsA</div>
<div class="tip" id="fs120">val xs : #IQueryable&lt;&#39;b&gt; (requires equality)</div>
<div class="tip" id="fs121">val u : &#39;b (requires equality)</div>
<div class="tip" id="fs122">val x : &#39;b (requires equality)</div>
<div class="tip" id="fs123">val containsB : unit -&gt; Expr&lt;(#IQueryable&lt;&#39;b&gt; -&gt; &#39;b -&gt; bool)&gt; (requires equality)<br /><br />Full name: Tutorial.containsB</div>
<div class="tip" id="fs124">val containsC : unit -&gt; Expr&lt;(#IQueryable&lt;&#39;b&gt; -&gt; &#39;b -&gt; bool)&gt;<br /><br />Full name: Tutorial.containsC</div>
<div class="tip" id="fs125">val u : &#39;b</div>
<div class="tip" id="fs126">custom operation: contains (&#39;T)<br /><br />Calls Linq.QueryBuilder.Contains </div>
<div class="tip" id="fs127">val expertise : Expr&lt;(string -&gt; IQueryable&lt;string&gt;)&gt;<br /><br />Full name: Tutorial.expertise</div>
<div class="tip" id="fs128">val d : DepartmentEmployees</div>
<div class="tip" id="fs129">val nestedDb : Expr&lt;IQueryable&lt;DepartmentEmployees&gt;&gt;<br /><br />Full name: Tutorial.nestedDb</div>
<div class="tip" id="fs130">DepartmentEmployees.employees: IQueryable&lt;EmployeeTasks&gt;</div>
<div class="tip" id="fs131">val e : EmployeeTasks</div>
<div class="tip" id="fs132">EmployeeTasks.tasks: IQueryable&lt;string&gt;</div>
<div class="tip" id="fs133">val ex9 : IQueryable&lt;string&gt;<br /><br />Full name: Tutorial.ex9</div>

        </div>
        <div class="span3">
          <ul class="nav nav-list" id="menu">
            <li class="nav-header">FSharpComposableQuery</li>
            <li><a href="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="https://www.nuget.org/packages/FSharpComposableQuery">Get Library via NuGet</a></li>
            <li><a href="https://github.com/fsharp/FSharpComposableQuery">Source Code on GitHub</a></li>
            <li><a href="https://github.com/fsharp/FSharpComposableQuery/blob/master/LICENSE.txt">License</a></li>
            <li><a href="https://github.com/fsharp/FSharpComposableQuery/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/index.html">Home page</a></li>
            <li><a href="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/tutorial.html">Tutorial</a></li>
            <li><a href="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/QueryExamples.html">Query Examples</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://fsprojects.github.io/FSharp.Linq.Experimental.ComposableQuery/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/fsharp/FSharpComposableQuery"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>
